#!/bin/sh

# We cannot use go test -coverprofile=cover.out ./... because
# the tool requires that it be used only on one package when
# capturing the coverage

# This is why we need this little script here.
packages="./src/cache ./src/apps/pblcached"

for pkg in $packages ; do
    echo "-- Testing $pkg --"
    go test -coverprofile=cover.out $pkg || exit 1
    go tool cover -func=cover.out
    rm -f cover.out
done
